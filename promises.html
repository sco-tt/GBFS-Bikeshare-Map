<!doctype html>
<html>
<head>
</head>
<body>
<script>
'use strict';
	function MapModel() {
  console.log('mapModel');
  var _this = this;

  this.url = 'https://www.rideindego.com/stations/json/';
  this.data = {};
  this.feedsList = {};

  this.sendRequest = function(systemName,url) {
    console.log('model.sendRequest');
    _this.request = this.CORSRequest('GET', url);

    if (!this.request) {
      throw new Error('CORS not supported');
    }
    this.request.send();

    this.request.onload = function() {
    	_this.data[systemName] = JSON.parse(this.responseText);
    	_this.getStationFeeds(systemName);
    	_this.getStationData();
    };
    this.request.onerror = function() {
      throw new Error('There was an error!');
    };
  };
} //mapModel

MapModel.prototype = {
  // Draw the Map of Philadelphia
  
  CORSRequest: function (method, url) {
    var xhr = new XMLHttpRequest();
    if ('withCredentials' in xhr) {
      // Check if the XMLHttpRequest object has a "withCredentials" property.
      // "withCredentials" only exists on XMLHTTPRequest2 objects.
      xhr.open(method, url, true);
    } else if (typeof XDomainRequest !== 'undefined') {
      // Otherwise, check if XDomainRequest.
      // XDomainRequest only exists in IE, and is IE's way of making CORS requests.
      xhr = new XDomainRequest();
      xhr.open(method, url);
    } else {
      // Otherwise, CORS is not supported by the browser.
      xhr = null;
    }
    return xhr;
  }, 

  getStationFeeds: function(systemName) {
  	var feeds = this.data[systemName].data.en.feeds;
  	var stationFeeds = {};
  	for (var i = 0; i < feeds.length; ++i) {
  		if (feeds[i]['name'] === 'station_status') {
  			stationFeeds['station_status'] = [feeds[i]['name'], feeds[i]['url']];
  		} else if (feeds[i]['name'] === 'station_information') {
  			stationFeeds['station_information'] = [feeds[i]['name'], feeds[i]['url']];
  		}
  	}
  	this.feedsList[systemName] = stationFeeds;
  }, 

  getStationData: function() {
  	console.log('this is getStationData');
  	console.log(this.feedsList);
  }

};

var model = new MapModel();
model.sendRequest('bcycle_indego','https://gbfs.bcycle.com/bcycle_indego/gbfs.json');
</script>

</body>
</html>